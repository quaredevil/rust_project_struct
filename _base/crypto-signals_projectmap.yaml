# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CRYPTO-SIGNALS - PROJECT MAP
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Sistema de anÃ¡lise tÃ©cnica e geraÃ§Ã£o de sinais de trading
# Linguagem: Rust
# VersÃ£o: 1.0.0
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 1. OVERVIEW DO PROJETO                                      â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

project:
  name: crypto-signals
  description: |
    ServiÃ§o responsÃ¡vel por consumir preÃ§os em tempo real, aplicar estratÃ©gias
    de anÃ¡lise tÃ©cnica, gerar sinais de trading (compra/venda) e publicÃ¡-los
    para consumo pelo crypto-trader.
    
    CaracterÃ­sticas principais:
    - MÃºltiplas estratÃ©gias de anÃ¡lise tÃ©cnica (plugin-based)
    - Suporte a mÃºltiplos timeframes (1m, 5m, 15m, 1h, 4h, 1d)
    - Indicadores tÃ©cnicos (RSI, MACD, MA, Bollinger Bands, etc.)
    - Gerenciamento de candles (OHLCV)
    - Backtesting de estratÃ©gias
    - Filtragem e combinaÃ§Ã£o de sinais
    - CÃ¡lculo de confidence baseado em mÃºltiplos fatores
    - Suporte a mÃºltiplos symbols simultaneamente
    - Hot-reload de estratÃ©gias
    - MÃ©tricas e observabilidade completa

  language: Rust
  async_runtime: tokio
  message_broker: Kafka (rdkafka)
  technical_analysis: ta (rust-ta ou implementaÃ§Ã£o prÃ³pria)
  
  responsibilities:
    - Consumir preÃ§os em tempo real do crypto-listener
    - Construir e manter candles (OHLCV) por timeframe
    - Aplicar estratÃ©gias de anÃ¡lise tÃ©cnica
    - Calcular indicadores tÃ©cnicos
    - Gerar sinais de compra/venda
    - Filtrar sinais (confidence, confirmaÃ§Ãµes)
    - Publicar sinais no Kafka
    - Manter histÃ³rico de sinais gerados
    - Prover mÃ©tricas de performance de estratÃ©gias
    - Suportar backtesting


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 2. ARQUITETURA                                               â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

architecture:
  pattern: Event-Driven + Hexagonal Architecture + Strategy Pattern + Plugin System
  
  components:
    price_consumer:
      description: Consome preÃ§os do Kafka (crypto-listener.prices)
      technology: rdkafka
      concurrency: Multi-threaded tokio tasks
      
    candle_builder:
      description: ConstrÃ³i candles OHLCV a partir de ticks
      timeframes: [1m, 5m, 15m, 30m, 1h, 4h, 1d]
      strategy: Time-based windowing
      storage: In-memory + Postgres (historical)
      
    indicator_calculator:
      description: Calcula indicadores tÃ©cnicos
      indicators:
        - SMA (Simple Moving Average)
        - EMA (Exponential Moving Average)
        - RSI (Relative Strength Index)
        - MACD (Moving Average Convergence Divergence)
        - Bollinger Bands
        - Stochastic
        - ADX (Average Directional Index)
        - ATR (Average True Range)
      library: ta-rs ou implementaÃ§Ã£o prÃ³pria
      caching: Redis (para performance)
      
    strategy_engine:
      description: Executa estratÃ©gias de trading
      pattern: Plugin-based (trait TradingStrategy)
      strategies:
        - RSI Divergence
        - MACD Crossover
        - MA Crossover (Golden/Death Cross)
        - Bollinger Bands Breakout
        - Support/Resistance
        - Multi-Indicator Confluence
      hot_reload: true
      
    signal_filter:
      description: Filtra sinais baseado em regras
      filters:
        - Minimum confidence threshold
        - Multiple strategy confirmation
        - Timeframe alignment
        - Volume validation
        - Trend confirmation
        
    confidence_calculator:
      description: Calcula confidence de sinais
      factors:
        - Strategy strength
        - Multiple indicator agreement
        - Timeframe confluence
        - Volume profile
        - Trend alignment
      output: 0.0 a 1.0
      
    signal_publisher:
      description: Publica sinais no Kafka
      technology: rdkafka
      topics: [signals.buy, signals.sell]
      
    backtester:
      description: Testa estratÃ©gias com dados histÃ³ricos
      features:
        - Historical candle replay
        - Performance metrics (win rate, profit factor, etc.)
        - Strategy parameter optimization
        
    metrics:
      description: Coleta mÃ©tricas
      technology: Prometheus (rust-prometheus)
      
  data_flow: |
    Kafka (prices) â†’ Price Consumer â†’ Candle Builder â†’ Indicator Calculator â†’
    Strategy Engine â†’ Signal Filter â†’ Confidence Calculator â†’ Signal Publisher â†’ Kafka (signals)
                                â†“
                         Strategy State Store
                                â†“
                            Metrics


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 3. TÃ“PICOS KAFKA                                             â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

kafka_topics:
  consumed:
    - name: crypto-listener.prices
      description: PreÃ§os em tempo real
      producer: crypto-listener
      consumer_group: crypto-signals-group
      
      schema:
        symbol: string
        price: number
        volume: number (quantity traded)
        timestamp: ISO8601
        
      example_payload: |
        {
          "symbol": "BTCUSDT",
          "price": 45123.50,
          "volume": 0.5,
          "timestamp": "2025-10-16T22:00:00Z"
        }

    - name: management.control.strategy
      description: Comandos de controle de estratÃ©gias
      producer: crypto-management
      
      schema:
        action: enum [ENABLE, DISABLE, UPDATE_PARAMS]
        strategy: string
        symbols: array ou "ALL"
        params: object (parÃ¢metros da estratÃ©gia)

  produced:
    - name: signals.buy
      description: Sinais de compra gerados por estratÃ©gias
      consumers:
        - crypto-trader
        - crypto-management
        
      schema:
        symbol:
          type: string
          description: Par de negociaÃ§Ã£o
          
        strategy:
          type: string
          description: Nome da estratÃ©gia que gerou o sinal
          examples: ["RSI_DIVERGENCE", "MACD_CROSSOVER", "MA_GOLDEN_CROSS"]
          
        source:
          type: string
          fixed: "internal"
          description: Sempre "internal" para crypto-signals
          
        confidence:
          type: number
          description: NÃ­vel de confianÃ§a (0.0 a 1.0)
          calculation: Baseado em mÃºltiplos fatores
          
        target_price:
          type: number
          description: PreÃ§o atual/sugerido de entrada
          
        stop_loss:
          type: number
          optional: true
          description: Stop loss calculado (baseado em ATR ou % fixo)
          
        take_profit:
          type: number
          optional: true
          description: Take profit calculado (risk/reward ratio)
          
        quantity:
          type: number
          optional: true
          description: Quantidade sugerida (raramente usado)
          
        metadata:
          type: object
          description: Metadados da estratÃ©gia
          fields:
            timeframe: Timeframe usado (ex: "15m")
            indicators: Valores dos indicadores
            candle_timestamp: Timestamp do candle que gerou sinal
            signal_strength: ForÃ§a do sinal (0-100)
            confluences: NÃºmero de confirmaÃ§Ãµes
            volume_profile: InformaÃ§Ãµes de volume
          
        timestamp:
          type: string
          format: ISO8601
          description: Timestamp de geraÃ§Ã£o do sinal
          
      example_payload: |
        {
          "symbol": "BTCUSDT",
          "strategy": "RSI_DIVERGENCE",
          "source": "internal",
          "confidence": 0.85,
          "target_price": 45123.50,
          "stop_loss": 44000.00,
          "take_profit": 47500.00,
          "metadata": {
            "timeframe": "15m",
            "indicators": {
              "rsi": 28.5,
              "rsi_divergence": "bullish",
              "macd_histogram": 12.5
            },
            "candle_timestamp": "2025-10-16T22:00:00Z",
            "signal_strength": 85,
            "confluences": 3,
            "volume_profile": {
              "volume_ma_ratio": 1.5,
              "trend": "increasing"
            }
          },
          "timestamp": "2025-10-16T22:00:15Z"
        }

    - name: signals.sell
      description: Sinais de venda
      schema: Similar ao signals.buy


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 4. MAPA DE PASTAS                                            â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

project_structure:
  description: Estrutura completa do projeto com descriÃ§Ã£o de cada mÃ³dulo
  architecture_layers: |
    Presentation â†’ Application â†’ Domain
                       â†“
                Infrastructure
    
    - Domain: nÃ£o depende de ninguÃ©m (nÃºcleo puro)
    - Application: depende apenas de Domain
    - Infrastructure: implementa contratos de Application
    - Presentation: usa Application e injeta Infrastructure via DI
    
  structure: |
    crypto-signals/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main.rs                          # Entry point: bootstrap do app (config, consumer, strategies, publisher, HTTP server)
    â”‚   â”œâ”€â”€ lib.rs                           # Biblioteca pÃºblica expondo mÃ³dulos principais
    â”‚   â”‚
    â”‚   â”œâ”€â”€ domain/                          # â­ Camada de DomÃ­nio (regras de negÃ³cio puras, sem I/O)
    â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”œâ”€â”€ errors.rs                    # Erros de domÃ­nio (StrategyError, IndicatorError)
    â”‚   â”‚   â”œâ”€â”€ aggregates/                  # Agregados DDD
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ candle.rs                # CandleAggregate (constrÃ³i, valida OHLCV)
    â”‚   â”‚   â”‚   â”œâ”€â”€ signal.rs                # SignalAggregate (valida, calcula confidence)
    â”‚   â”‚   â”‚   â”œâ”€â”€ strategy.rs              # StrategyAggregate (executa, mantÃ©m estado)
    â”‚   â”‚   â”‚   â””â”€â”€ market_state.rs          # MarketStateAggregate (gerencia estado do mercado)
    â”‚   â”‚   â”œâ”€â”€ entities/                    # Entidades de domÃ­nio
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ candle.rs                # Entidade Candle (OHLCV)
    â”‚   â”‚   â”‚   â”œâ”€â”€ tick.rs                  # Entidade Tick (price update)
    â”‚   â”‚   â”‚   â”œâ”€â”€ signal.rs                # Entidade Signal
    â”‚   â”‚   â”‚   â””â”€â”€ indicator.rs             # Entidade Indicator (valor calculado)
    â”‚   â”‚   â”œâ”€â”€ events/                      # Domain events
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ candle_events.rs         # CandleCompleted, CandleUpdated
    â”‚   â”‚   â”‚   â”œâ”€â”€ signal_events.rs         # SignalGenerated, SignalFiltered
    â”‚   â”‚   â”‚   â””â”€â”€ strategy_events.rs       # StrategyEnabled, StrategyDisabled, StrategyTriggered
    â”‚   â”‚   â”œâ”€â”€ repositories/                # Traits de repositÃ³rios (contratos)
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ candle_repository.rs     # Contrato para armazenar candles histÃ³ricos
    â”‚   â”‚   â”‚   â”œâ”€â”€ signal_repository.rs     # Contrato para persistir sinais
    â”‚   â”‚   â”‚   â””â”€â”€ strategy_repository.rs   # Contrato para configuraÃ§Ãµes de estratÃ©gias
    â”‚   â”‚   â”œâ”€â”€ services/                    # ServiÃ§os de domÃ­nio
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ candle_builder.rs        # ConstrÃ³i candles a partir de ticks
    â”‚   â”‚   â”‚   â”œâ”€â”€ indicator_calculator.rs  # Calcula indicadores tÃ©cnicos
    â”‚   â”‚   â”‚   â”œâ”€â”€ signal_validator.rs      # Valida sinais (regras de negÃ³cio)
    â”‚   â”‚   â”‚   â”œâ”€â”€ confidence_calculator.rs # Calcula confidence de sinais
    â”‚   â”‚   â”‚   â””â”€â”€ trend_analyzer.rs        # Analisa tendÃªncia de mercado
    â”‚   â”‚   â””â”€â”€ value_objects/               # Value objects
    â”‚   â”‚       â”œâ”€â”€ mod.rs
    â”‚   â”‚       â”œâ”€â”€ symbol.rs                # VO Symbol
    â”‚   â”‚       â”œâ”€â”€ timeframe.rs             # VO Timeframe (1m, 5m, 15m, etc.)
    â”‚   â”‚       â”œâ”€â”€ price.rs                 # VO Price
    â”‚   â”‚       â”œâ”€â”€ volume.rs                # VO Volume
    â”‚   â”‚       â”œâ”€â”€ confidence.rs            # VO Confidence (0.0 a 1.0)
    â”‚   â”‚       â”œâ”€â”€ signal_type.rs           # VO SignalType (BUY, SELL)
    â”‚   â”‚       â””â”€â”€ strategy_name.rs         # VO StrategyName
    â”‚   â”‚
    â”‚   â”œâ”€â”€ application/                     # â­ Camada de AplicaÃ§Ã£o (casos de uso, orquestraÃ§Ã£o)
    â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”œâ”€â”€ dtos/                        # Data Transfer Objects
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ commands.rs              # Command DTOs (GenerateSignalCommand)
    â”‚   â”‚   â”‚   â”œâ”€â”€ candle_dto.rs            # DTO para candles
    â”‚   â”‚   â”‚   â”œâ”€â”€ signal_dto.rs            # DTO para sinais
    â”‚   â”‚   â”‚   â”œâ”€â”€ requests.rs              # HTTP request DTOs
    â”‚   â”‚   â”‚   â””â”€â”€ responses.rs             # HTTP response DTOs
    â”‚   â”‚   â”œâ”€â”€ ports/                       # âš¡ Ports (interfaces/contratos para adapters)
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ price_consumer_port.rs   # Contrato para consumir preÃ§os (Kafka)
    â”‚   â”‚   â”‚   â”œâ”€â”€ signal_publisher_port.rs # Contrato para publicar sinais (Kafka)
    â”‚   â”‚   â”‚   â”œâ”€â”€ candle_store_port.rs     # Contrato para armazenar candles
    â”‚   â”‚   â”‚   â”œâ”€â”€ indicator_cache_port.rs  # Contrato para cache de indicadores (Redis)
    â”‚   â”‚   â”‚   â””â”€â”€ market_data_port.rs      # Contrato para dados histÃ³ricos
    â”‚   â”‚   â”œâ”€â”€ strategies/                  # ğŸ”Œ EstratÃ©gias (plugins)
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ strategy_trait.rs        # Trait TradingStrategy
    â”‚   â”‚   â”‚   â”œâ”€â”€ rsi_divergence.rs        # EstratÃ©gia: RSI Divergence
    â”‚   â”‚   â”‚   â”œâ”€â”€ macd_crossover.rs        # EstratÃ©gia: MACD Crossover
    â”‚   â”‚   â”‚   â”œâ”€â”€ ma_crossover.rs          # EstratÃ©gia: MA Crossover (Golden/Death Cross)
    â”‚   â”‚   â”‚   â”œâ”€â”€ bollinger_breakout.rs    # EstratÃ©gia: Bollinger Bands Breakout
    â”‚   â”‚   â”‚   â”œâ”€â”€ support_resistance.rs    # EstratÃ©gia: Support/Resistance
    â”‚   â”‚   â”‚   â””â”€â”€ multi_indicator.rs       # EstratÃ©gia: Multi-Indicator Confluence
    â”‚   â”‚   â”œâ”€â”€ filters/                     # Filtros de sinais
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ filter_trait.rs          # Trait SignalFilter
    â”‚   â”‚   â”‚   â”œâ”€â”€ confidence_filter.rs     # Filtra por confidence mÃ­nima
    â”‚   â”‚   â”‚   â”œâ”€â”€ volume_filter.rs         # Filtra por volume
    â”‚   â”‚   â”‚   â”œâ”€â”€ trend_filter.rs          # Filtra por alinhamento de tendÃªncia
    â”‚   â”‚   â”‚   â””â”€â”€ timeframe_filter.rs      # Filtra por confluÃªncia de timeframes
    â”‚   â”‚   â”œâ”€â”€ queries/                     # Queries (CQRS read-side)
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ get_signal_history.rs    # Query: histÃ³rico de sinais
    â”‚   â”‚   â”‚   â”œâ”€â”€ get_strategy_stats.rs    # Query: estatÃ­sticas por estratÃ©gia
    â”‚   â”‚   â”‚   â””â”€â”€ get_candles.rs           # Query: candles histÃ³ricos
    â”‚   â”‚   â””â”€â”€ services/                    # Application services (orquestraÃ§Ã£o de casos de uso)
    â”‚   â”‚       â”œâ”€â”€ mod.rs
    â”‚   â”‚       â”œâ”€â”€ signal_service.rs        # Caso de uso: gerar e publicar sinal
    â”‚   â”‚       â”œâ”€â”€ strategy_service.rs      # Caso de uso: gerenciar estratÃ©gias
    â”‚   â”‚       â”œâ”€â”€ candle_service.rs        # Caso de uso: gerenciar candles
    â”‚   â”‚       â””â”€â”€ analysis_orchestrator.rs # Orquestra: price â†’ candle â†’ indicators â†’ strategies â†’ signals
    â”‚   â”‚
    â”‚   â”œâ”€â”€ infrastructure/                  # â­ Camada de Infraestrutura (implementaÃ§Ãµes tÃ©cnicas)
    â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”œâ”€â”€ bootstrap/                   # InicializaÃ§Ã£o de componentes
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ database.rs              # Setup de conexÃ£o Postgres + migrations
    â”‚   â”‚   â”‚   â”œâ”€â”€ redis.rs                 # Setup de conexÃ£o Redis
    â”‚   â”‚   â”‚   â”œâ”€â”€ kafka_consumer.rs        # Inicializa consumer Kafka (prices)
    â”‚   â”‚   â”‚   â”œâ”€â”€ kafka_publisher.rs       # Inicializa publisher Kafka (signals)
    â”‚   â”‚   â”‚   â””â”€â”€ strategies.rs            # Inicializa e registra estratÃ©gias
    â”‚   â”‚   â”œâ”€â”€ config/                      # ConfiguraÃ§Ã£o e settings
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ settings.rs              # Struct Settings + carregamento de env vars
    â”‚   â”‚   â”‚   â””â”€â”€ strategy_config.rs       # ConfiguraÃ§Ãµes de estratÃ©gias
    â”‚   â”‚   â”œâ”€â”€ messaging/                   # Messaging
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ kafka_price_consumer.rs  # Consumer de preÃ§os
    â”‚   â”‚   â”‚   â”œâ”€â”€ kafka_signal_publisher.rs # Publisher de sinais
    â”‚   â”‚   â”‚   â””â”€â”€ price_handler.rs         # Handler que processa preÃ§os recebidos
    â”‚   â”‚   â”œâ”€â”€ candles/                     # Gerenciamento de candles
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ time_based_builder.rs    # ConstrÃ³i candles baseado em tempo
    â”‚   â”‚   â”‚   â””â”€â”€ candle_aggregator.rs     # Agrega mÃºltiplos timeframes
    â”‚   â”‚   â”œâ”€â”€ indicators/                  # ImplementaÃ§Ãµes de indicadores tÃ©cnicos
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ sma.rs                   # Simple Moving Average
    â”‚   â”‚   â”‚   â”œâ”€â”€ ema.rs                   # Exponential Moving Average
    â”‚   â”‚   â”‚   â”œâ”€â”€ rsi.rs                   # Relative Strength Index
    â”‚   â”‚   â”‚   â”œâ”€â”€ macd.rs                  # MACD
    â”‚   â”‚   â”‚   â”œâ”€â”€ bollinger.rs             # Bollinger Bands
    â”‚   â”‚   â”‚   â”œâ”€â”€ stochastic.rs            # Stochastic Oscillator
    â”‚   â”‚   â”‚   â”œâ”€â”€ adx.rs                   # Average Directional Index
    â”‚   â”‚   â”‚   â””â”€â”€ atr.rs                   # Average True Range
    â”‚   â”‚   â”œâ”€â”€ persistence/                 # PersistÃªncia
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ postgres_candle_repository.rs    # Store de candles histÃ³ricos
    â”‚   â”‚   â”‚   â”œâ”€â”€ postgres_signal_repository.rs    # Store de sinais
    â”‚   â”‚   â”‚   â”œâ”€â”€ postgres_strategy_repository.rs  # Store de configuraÃ§Ãµes
    â”‚   â”‚   â”‚   â””â”€â”€ redis_indicator_cache.rs         # Cache de indicadores
    â”‚   â”‚   â”œâ”€â”€ backtesting/                 # Backtesting
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ backtest_engine.rs       # Engine de backtesting
    â”‚   â”‚   â”‚   â”œâ”€â”€ historical_replay.rs     # Replay de candles histÃ³ricos
    â”‚   â”‚   â”‚   â””â”€â”€ performance_calculator.rs # Calcula mÃ©tricas de performance
    â”‚   â”‚   â”œâ”€â”€ metrics/                     # MÃ©tricas e observabilidade
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â””â”€â”€ prometheus_metrics.rs    # Registra mÃ©tricas Prometheus
    â”‚   â”‚   â”œâ”€â”€ shutdown/                    # Shutdown graceful
    â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â”‚   â”œâ”€â”€ graceful.rs              # Coordena shutdown
    â”‚   â”‚   â”‚   â””â”€â”€ signal_handler.rs        # Captura sinais SIGTERM/SIGINT
    â”‚   â”‚   â””â”€â”€ startup/                     # Startup do aplicativo
    â”‚   â”‚       â”œâ”€â”€ mod.rs
    â”‚   â”‚       â”œâ”€â”€ banner.rs                # Banner ASCII no console
    â”‚   â”‚       â”œâ”€â”€ health.rs                # Health checks
    â”‚   â”‚       â””â”€â”€ logging.rs               # Setup de logs (tracing-subscriber)
    â”‚   â”‚
    â”‚   â”œâ”€â”€ presentation/                    # â­ Camada de ApresentaÃ§Ã£o (HTTP REST API)
    â”‚   â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚   â””â”€â”€ http/                        # HTTP REST API (Axum)
    â”‚   â”‚       â”œâ”€â”€ mod.rs
    â”‚   â”‚       â”œâ”€â”€ router.rs                # DefiniÃ§Ã£o de rotas (endpoints)
    â”‚   â”‚       â”œâ”€â”€ responses.rs             # Helpers de resposta (ApiResponse, ErrorResponse)
    â”‚   â”‚       â”œâ”€â”€ controllers/             # Controllers HTTP
    â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”‚       â”‚   â”œâ”€â”€ signal_controller.rs # Endpoints de sinais (history, stats)
    â”‚   â”‚       â”‚   â”œâ”€â”€ strategy_controller.rs # Endpoints de estratÃ©gias (enable, disable, config)
    â”‚   â”‚       â”‚   â”œâ”€â”€ candle_controller.rs # Endpoints de candles (get, query)
    â”‚   â”‚       â”‚   â”œâ”€â”€ backtest_controller.rs # Endpoints de backtesting
    â”‚   â”‚       â”‚   â””â”€â”€ health_controller.rs # Health checks, metrics
    â”‚   â”‚       â””â”€â”€ middleware/              # Middlewares HTTP
    â”‚   â”‚           â”œâ”€â”€ mod.rs
    â”‚   â”‚           â””â”€â”€ request_logger.rs    # Log de requests HTTP
    â”‚   â”‚
    â”‚   â””â”€â”€ shared/                          # â­ Shared Kernel (cÃ³digo transversal)
    â”‚       â”œâ”€â”€ mod.rs
    â”‚       â”œâ”€â”€ errors.rs                    # Erros compartilhados (ApplicationError, InfrastructureError)
    â”‚       â”œâ”€â”€ types.rs                     # Tipos compartilhados (EventEnvelope, Timestamp, etc.)
    â”‚       â”œâ”€â”€ traits/                      # Traits comuns
    â”‚       â”‚   â”œâ”€â”€ mod.rs
    â”‚       â”‚   â””â”€â”€ aggregate_root.rs        # Trait AggregateRoot
    â”‚       â””â”€â”€ utils/                       # UtilitÃ¡rios
    â”‚           â”œâ”€â”€ mod.rs
    â”‚           â”œâ”€â”€ datetime.rs              # Helpers de data/hora
    â”‚           â”œâ”€â”€ math.rs                  # Helpers matemÃ¡ticos (mÃ©dias, etc.)
    â”‚           â””â”€â”€ validation.rs            # ValidaÃ§Ãµes genÃ©ricas
    â”‚
    â”œâ”€â”€ config/                              # ğŸ“ ConfiguraÃ§Ãµes externas
    â”‚   â”œâ”€â”€ development.yaml                 # Config para ambiente dev
    â”‚   â”œâ”€â”€ production.yaml                  # Config para ambiente prod
    â”‚   â””â”€â”€ strategies/                      # ConfiguraÃ§Ãµes de estratÃ©gias
    â”‚       â”œâ”€â”€ rsi_divergence.yaml          # Params: rsi_period, oversold, overbought
    â”‚       â”œâ”€â”€ macd_crossover.yaml          # Params: fast, slow, signal
    â”‚       â”œâ”€â”€ ma_crossover.yaml            # Params: fast_period, slow_period
    â”‚       â””â”€â”€ bollinger_breakout.yaml      # Params: period, std_dev
    â”‚
    â”œâ”€â”€ migrations/                          # ğŸ“Š MigraÃ§Ãµes de banco (Flyway)
    â”‚   â”œâ”€â”€ V001__initial_schema.sql         # Schema inicial (candles, signals, strategies)
    â”‚   â”œâ”€â”€ V002__indexes.sql                # Ãndices para performance
    â”‚   â””â”€â”€ V003__backtesting_tables.sql     # Tabelas para backtesting
    â”‚
    â”œâ”€â”€ data/                                # ğŸ“ˆ Dados histÃ³ricos (para backtesting)
    â”‚   â””â”€â”€ historical_candles/              # Candles histÃ³ricos (CSV ou Parquet)
    â”‚       â”œâ”€â”€ BTCUSDT_1m.csv
    â”‚       â”œâ”€â”€ BTCUSDT_5m.csv
    â”‚       â””â”€â”€ ETHUSDT_1h.csv
    â”‚
    â”œâ”€â”€ docs/                                # ğŸ“š DocumentaÃ§Ã£o tÃ©cnica
    â”‚   â”œâ”€â”€ README.md                        # Ãndice de documentaÃ§Ã£o
    â”‚   â”œâ”€â”€ ARCHITECTURE.md                  # Detalhes da arquitetura
    â”‚   â”œâ”€â”€ STRATEGIES.md                    # DocumentaÃ§Ã£o de estratÃ©gias
    â”‚   â”œâ”€â”€ INDICATORS.md                    # DocumentaÃ§Ã£o de indicadores
    â”‚   â””â”€â”€ BACKTESTING.md                   # Guia de backtesting
    â”‚
    â”œâ”€â”€ Cargo.toml                           # ConfiguraÃ§Ã£o Rust (deps, features)
    â”œâ”€â”€ Cargo.lock                           # Lock file de dependÃªncias
    â”œâ”€â”€ Dockerfile                           # Build multi-stage production
    â”œâ”€â”€ docker-compose.yml                   # Stack completa (app, Kafka, Postgres, Redis)
    â”œâ”€â”€ Makefile                             # Comandos make (build, test, backtest, docker)
    â”œâ”€â”€ crypto-signals_projectmap.yaml       # Este arquivo (documentaÃ§Ã£o estruturada)
    â””â”€â”€ README.md                            # DocumentaÃ§Ã£o principal do projeto
    
  conventions:
    domain_layer:
      description: Camada de DomÃ­nio (domain/)
      rules:
        - âœ… Sem dependÃªncias de infraestrutura
        - âœ… LÃ³gica de negÃ³cio pura (cÃ¡lculos, validaÃ§Ãµes)
        - âœ… Aggregates aplicam eventos e validam invariantes
        - âœ… Value objects imutÃ¡veis com validaÃ§Ã£o
        - âœ… Services de domÃ­nio para lÃ³gica cross-aggregate
        - âœ… Repositories como traits (contratos apenas)
        - âœ… CÃ¡lculos de indicadores como services de domÃ­nio
        
    application_layer:
      description: Camada de AplicaÃ§Ã£o (application/)
      rules:
        - âœ… Define Ports (interfaces) que infraestrutura implementa
        - âœ… Orquestra casos de uso (price â†’ candle â†’ analysis â†’ signal)
        - âœ… DTOs para comunicaÃ§Ã£o entre camadas
        - âœ… Strategies como plugins (trait-based)
        - âœ… Filters como plugins (trait-based)
        - âœ… Queries para read-side (CQRS)
        - âœ… NÃ£o conhece detalhes de implementaÃ§Ã£o (Kafka, Redis, TA-Lib)
        
    infrastructure_layer:
      description: Camada de Infraestrutura (infrastructure/)
      rules:
        - âœ… Implementa Adapters (Kafka, Postgres, Redis)
        - âœ… Bootstrap e configuraÃ§Ã£o
        - âœ… Messaging (consumer/publisher)
        - âœ… Persistence (candles, signals)
        - âœ… Indicadores tÃ©cnicos (implementaÃ§Ã£o ou wrapper TA-Lib)
        - âœ… Backtesting engine
        - âœ… Shutdown graceful
        - âœ… Startup e health checks
        
    presentation_layer:
      description: Camada de ApresentaÃ§Ã£o (presentation/)
      rules:
        - âœ… HTTP REST API (Axum)
        - âœ… Controllers e routers
        - âœ… ConversÃ£o DTOs <-> JSON
        - âœ… Middlewares (logging)
        - âœ… NÃ£o contÃ©m lÃ³gica de negÃ³cio
        - âœ… Endpoints para consultas e controle
        
    shared_kernel:
      description: Shared Kernel (shared/)
      rules:
        - âœ… CÃ³digo compartilhado entre camadas
        - âœ… Traits comuns (AggregateRoot)
        - âœ… Tipos transversais (EventEnvelope)
        - âœ… UtilitÃ¡rios (datetime, math, validaÃ§Ã£o)
        - âœ… Erros compartilhados


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 5. ESTRATÃ‰GIAS DE TRADING                                    â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

trading_strategies:
  trait_definition: |
    pub trait TradingStrategy: Send + Sync {
        fn name(&self) -> &str;
        fn analyze(&self, candles: &[Candle], indicators: &IndicatorSet) 
            -> Result<Option<Signal>>;
        fn required_candles(&self) -> usize;
        fn timeframes(&self) -> &[Timeframe];
        fn default_params(&self) -> StrategyParams;
    }
  
  strategies:
    rsi_divergence:
      name: RSI Divergence
      description: |
        Detecta divergÃªncias entre preÃ§o e RSI. DivergÃªncia bullish (preÃ§o faz
        lower low mas RSI faz higher low) indica possÃ­vel reversÃ£o de alta.
      parameters:
        rsi_period: 14
        oversold: 30
        overbought: 70
        lookback_periods: 20
      timeframes: [15m, 1h, 4h]
      required_candles: 50
      confidence_calculation: |
        base = 0.7
        + 0.1 se divergÃªncia clara (2+ swings)
        + 0.1 se RSI em zona extrema (<25 ou >75)
        + 0.05 se volume acima da mÃ©dia
      signals:
        - BUY quando divergÃªncia bullish + RSI < 30
        - SELL quando divergÃªncia bearish + RSI > 70
        
    macd_crossover:
      name: MACD Crossover
      description: |
        Crossover da linha MACD com a linha de sinal. Crossover acima
        indica momentum bullish, abaixo indica bearish.
      parameters:
        fast_period: 12
        slow_period: 26
        signal_period: 9
      timeframes: [15m, 1h, 4h]
      required_candles: 35
      confidence_calculation: |
        base = 0.75
        + 0.1 se histograma crescendo
        + 0.1 se crossover acima/abaixo de zero
        + 0.05 se alinhado com tendÃªncia (EMA200)
      signals:
        - BUY quando MACD cruza acima da signal line
        - SELL quando MACD cruza abaixo da signal line
        
    ma_crossover:
      name: MA Crossover (Golden/Death Cross)
      description: |
        Crossover de mÃ©dias mÃ³veis. Golden Cross (MA rÃ¡pida cruza acima da lenta)
        indica tendÃªncia de alta. Death Cross (cruza abaixo) indica baixa.
      parameters:
        fast_period: 50
        slow_period: 200
        ma_type: SMA ou EMA
      timeframes: [1h, 4h, 1d]
      required_candles: 210
      confidence_calculation: |
        base = 0.8
        + 0.1 se ambas MAs inclinadas na direÃ§Ã£o do sinal
        + 0.05 se distÃ¢ncia > 1% entre MAs
        + 0.05 se volume confirmando
      signals:
        - BUY quando MA50 cruza acima MA200 (Golden Cross)
        - SELL quando MA50 cruza abaixo MA200 (Death Cross)
        
    bollinger_breakout:
      name: Bollinger Bands Breakout
      description: |
        Breakout das Bollinger Bands. PreÃ§o tocando banda inferior em oversold
        pode indicar reversÃ£o. Breakout acima da banda superior indica forÃ§a.
      parameters:
        period: 20
        std_dev: 2.0
        rsi_period: 14
      timeframes: [15m, 1h]
      required_candles: 30
      confidence_calculation: |
        base = 0.7
        + 0.1 se RSI confirma (oversold/overbought)
        + 0.1 se volume spike
        + 0.05 se candle fecha fora da banda
      signals:
        - BUY quando preÃ§o toca banda inferior + RSI < 30
        - SELL quando preÃ§o toca banda superior + RSI > 70
        
    support_resistance:
      name: Support/Resistance Levels
      description: |
        Detecta nÃ­veis de suporte/resistÃªncia baseado em pivots histÃ³ricos.
        Bounce em suporte ou breakout de resistÃªncia gera sinais.
      parameters:
        lookback_periods: 50
        touch_tolerance: 0.002  # 0.2%
        min_touches: 2
      timeframes: [1h, 4h]
      required_candles: 60
      confidence_calculation: |
        base = 0.75
        + 0.1 se nÃ­vel testado 3+ vezes
        + 0.1 se volume confirmando
        + 0.05 se alinhado com tendÃªncia maior
      signals:
        - BUY em bounce de suporte forte
        - SELL em rejeiÃ§Ã£o de resistÃªncia forte
        
    multi_indicator:
      name: Multi-Indicator Confluence
      description: |
        Combina mÃºltiplos indicadores. Sinal apenas quando hÃ¡ confluÃªncia
        (mÃºltiplos indicadores concordam).
      required_indicators:
        - RSI
        - MACD
        - EMA (20, 50, 200)
        - Volume
      timeframes: [15m, 1h]
      required_candles: 210
      confluence_rules:
        buy:
          - RSI < 40 (oversold tendency)
          - MACD bullish crossover
          - PreÃ§o acima EMA20
          - Volume acima mÃ©dia
        sell:
          - RSI > 60 (overbought tendency)
          - MACD bearish crossover
          - PreÃ§o abaixo EMA20
          - Volume acima mÃ©dia
      confidence_calculation: |
        base = 0.6
        + 0.1 por cada indicador adicional confirmando (max 4)
        Exemplo: 3 indicadores = 0.6 + 0.3 = 0.9


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 6. INDICADORES TÃ‰CNICOS                                      â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

technical_indicators:
  implementation: Custom Rust ou ta-rs library
  
  indicators:
    sma:
      name: Simple Moving Average
      description: MÃ©dia aritmÃ©tica simples dos N Ãºltimos preÃ§os
      formula: SMA = (P1 + P2 + ... + Pn) / n
      parameters:
        period: nÃºmero de candles
      use_cases:
        - Identificar tendÃªncia
        - Suporte/resistÃªncia dinÃ¢mico
        - Componente de outras estratÃ©gias
        
    ema:
      name: Exponential Moving Average
      description: MÃ©dia que dÃ¡ mais peso aos preÃ§os recentes
      formula: EMA = Price * k + EMA(prev) * (1 - k), onde k = 2/(n+1)
      parameters:
        period: nÃºmero de candles
      use_cases:
        - Reage mais rÃ¡pido que SMA
        - Usado em MACD
        - Identificar tendÃªncia
        
    rsi:
      name: Relative Strength Index
      description: Oscilador que mede velocidade e magnitude de mudanÃ§as de preÃ§o
      formula: RSI = 100 - (100 / (1 + RS)), onde RS = mÃ©dia de ganhos / mÃ©dia de perdas
      parameters:
        period: 14 (padrÃ£o)
      output: 0 a 100
      zones:
        oversold: < 30
        overbought: > 70
      use_cases:
        - Identificar condiÃ§Ãµes de sobrecompra/sobrevenda
        - DivergÃªncias com preÃ§o
        - ConfirmaÃ§Ã£o de sinais
        
    macd:
      name: Moving Average Convergence Divergence
      description: Indicador de momentum baseado em divergÃªncia de EMAs
      formula: |
        MACD Line = EMA(12) - EMA(26)
        Signal Line = EMA(9) of MACD Line
        Histogram = MACD Line - Signal Line
      parameters:
        fast_period: 12
        slow_period: 26
        signal_period: 9
      use_cases:
        - Crossovers (MACD cruza signal)
        - DivergÃªncias
        - Histograma (momentum)
        
    bollinger_bands:
      name: Bollinger Bands
      description: Bandas de volatilidade ao redor de uma mÃ©dia mÃ³vel
      formula: |
        Middle Band = SMA(20)
        Upper Band = Middle + (2 * StdDev)
        Lower Band = Middle - (2 * StdDev)
      parameters:
        period: 20
        std_dev: 2.0
      use_cases:
        - Identificar volatilidade
        - Breakouts
        - ReversÃµes (toque nas bandas)
        
    stochastic:
      name: Stochastic Oscillator
      description: Compara preÃ§o de fechamento com range de preÃ§os
      formula: |
        %K = 100 * (Close - Low14) / (High14 - Low14)
        %D = SMA(3) of %K
      parameters:
        k_period: 14
        d_period: 3
      output: 0 a 100
      zones:
        oversold: < 20
        overbought: > 80
      use_cases:
        - CondiÃ§Ãµes de sobrecompra/sobrevenda
        - Crossovers de %K e %D
        - DivergÃªncias
        
    adx:
      name: Average Directional Index
      description: Mede forÃ§a da tendÃªncia (nÃ£o direÃ§Ã£o)
      formula: Baseado em +DI, -DI e smoothing
      parameters:
        period: 14
      output: 0 a 100
      interpretation:
        0-25: tendÃªncia fraca ou ausente
        25-50: tendÃªncia moderada
        50-75: tendÃªncia forte
        75-100: tendÃªncia muito forte
      use_cases:
        - Filtrar sinais (apenas em tendÃªncias fortes)
        - Confirmar breakouts
        
    atr:
      name: Average True Range
      description: Mede volatilidade (nÃ£o direÃ§Ã£o)
      formula: |
        True Range = max(High - Low, |High - Close(prev)|, |Low - Close(prev)|)
        ATR = SMA(14) of True Range
      parameters:
        period: 14
      use_cases:
        - Calcular stop loss dinÃ¢mico (ex: 2 * ATR)
        - Calcular take profit
        - Position sizing


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 7. GERENCIAMENTO DE CANDLES                                  â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

candle_management:
  concept: |
    Candles (OHLCV) sÃ£o construÃ­dos a partir de ticks (price updates) recebidos
    do crypto-listener. MÃºltiplos timeframes sÃ£o mantidos simultaneamente.
    
  candle_structure:
    fields:
      - symbol: string
      - timeframe: enum (1m, 5m, 15m, 30m, 1h, 4h, 1d)
      - open: first price in period
      - high: highest price in period
      - low: lowest price in period
      - close: last price in period
      - volume: sum of volumes in period
      - open_time: timestamp do inÃ­cio do perÃ­odo
      - close_time: timestamp do fim do perÃ­odo
      - num_trades: nÃºmero de trades (optional)
      
  timeframes:
    supported:
      - 1m: 1 minuto
      - 5m: 5 minutos
      - 15m: 15 minutos
      - 30m: 30 minutos
      - 1h: 1 hora
      - 4h: 4 horas
      - 1d: 1 dia
    selection: ConfigurÃ¡vel por estratÃ©gia
    
  building_process:
    strategy: Time-based windowing
    steps:
      - step: 1
        action: Receber tick (price update)
        
      - step: 2
        action: Determinar perÃ­odo(s) que o tick pertence
        example: |
          Tick Ã s 10:03:45
          â†’ pertence ao candle 1m: 10:03:00-10:03:59
          â†’ pertence ao candle 5m: 10:00:00-10:04:59
          â†’ pertence ao candle 1h: 10:00:00-10:59:59
          
      - step: 3
        action: Atualizar candle(s)
        logic: |
          Se primeiro tick do perÃ­odo: open = price
          Atualiza: high = max(high, price)
          Atualiza: low = min(low, price)
          Sempre: close = price
          Acumula: volume += tick.volume
          
      - step: 4
        action: Ao completar perÃ­odo, emitir CandleCompleted event
        
    storage:
      in_memory: Ãšltimos N candles por timeframe (buffer circular)
      postgres: Todos os candles histÃ³ricos (para backtesting)
      redis: Cache de indicadores calculados
      
  example_candle_buffer:
    description: MantÃ©m em memÃ³ria para performance
    structure: |
      HashMap<(Symbol, Timeframe), VecDeque<Candle>>
      
      Exemplo:
      {
        ("BTCUSDT", Timeframe::M15): [candle1, candle2, ..., candle100],
        ("BTCUSDT", Timeframe::H1): [candle1, candle2, ..., candle200],
        ("ETHUSDT", Timeframe::M15): [candle1, candle2, ..., candle100],
      }
    buffer_size:
      1m: 500 candles (~8 horas)
      5m: 300 candles (~25 horas)
      15m: 200 candles (~50 horas)
      1h: 200 candles (~8 dias)
      4h: 200 candles (~33 dias)
      1d: 365 candles (~1 ano)


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 8. FLUXOS PRINCIPAIS                                         â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

flows:
  price_to_signal:
    description: Fluxo completo de preÃ§o atÃ© geraÃ§Ã£o de sinal
    steps:
      - step: 1
        component: Kafka Consumer
        action: Consome price update do tÃ³pico crypto-listener.prices
        
      - step: 2
        component: Price Handler
        action: Deserializa payload e cria Tick entity
        
      - step: 3
        component: Candle Builder
        action: |
          - Identifica timeframes afetados
          - Atualiza candles em construÃ§Ã£o
          - Se candle completo â†’ emite CandleCompleted event
          
      - step: 4
        component: Candle Store
        action: |
          - Persiste candle completo (Postgres)
          - Atualiza buffer in-memory
          
      - step: 5
        component: Indicator Calculator
        action: |
          - Verifica cache (Redis)
          - Se nÃ£o cached: calcula indicadores necessÃ¡rios
          - Armazena no cache
          
      - step: 6
        component: Strategy Engine
        action: |
          - Para cada estratÃ©gia ativa:
            - Verifica se tem candles suficientes
            - Executa analyze() com candles e indicators
            - Se retorna sinal â†’ prossegue
          
      - step: 7
        component: Signal Validator
        action: |
          - Valida regras de negÃ³cio do sinal
          - Verifica consistÃªncia (stop_loss < entry < take_profit para BUY)
          
      - step: 8
        component: Signal Filters
        action: |
          - Aplica filtros configurados:
            - Confidence mÃ­nima
            - Volume mÃ­nimo
            - Alinhamento de tendÃªncia
            - ConfluÃªncia de timeframes
          - Se todos passam â†’ prossegue
          
      - step: 9
        component: Confidence Calculator
        action: |
          - Calcula confidence baseado em:
            - ForÃ§a da estratÃ©gia
            - ConfluÃªncia de indicadores
            - ConfluÃªncia de timeframes
            - Volume profile
          
      - step: 10
        component: Signal Enricher
        action: |
          - Adiciona metadata:
            - Valores de indicadores
            - Timeframe usado
            - Signal strength
            - NÃºmero de confluÃªncias
          
      - step: 11
        component: Signal Publisher
        action: |
          - Publica SignalDTO em signals.buy ou signals.sell
          - Serializa para JSON
          
      - step: 12
        component: Signal Repository
        action: Persiste sinal no banco (audit + analytics)
        
      - step: 13
        component: Metrics
        action: |
          - signals_generated_total{strategy="RSI_DIVERGENCE"} +1
          - Atualiza latÃªncia
          
    example_trace: |
      [Consumer] Price: BTCUSDT @ 45123.50
      [CandleBuilder] Updated 15m candle (O:45100 H:45150 L:45080 C:45123)
      [CandleBuilder] 15m candle completed â†’ event emitted
      [IndicatorCalc] Calculated RSI(14) = 28.5, MACD = 12.5
      [Strategy:RSI_DIVERGENCE] Detected bullish divergence
      [SignalValidator] Signal valid
      [Filters] Confidence: 0.85 âœ“, Volume: 1.5x avg âœ“, Trend: aligned âœ“
      [ConfidenceCalc] Final confidence: 0.85
      [Enricher] Added metadata (timeframe=15m, confluences=3)
      [Publisher] Published to signals.buy
      [Repository] Signal persisted (id=uuid...)
      [Metrics] signals_generated_total{strategy="RSI_DIVERGENCE",symbol="BTCUSDT"} +1

  strategy_enable:
    description: Habilitar estratÃ©gia via API ou Kafka
    steps:
      - step: 1
        component: HTTP API ou Kafka
        action: Recebe comando ENABLE_STRATEGY
        
      - step: 2
        component: Strategy Service
        action: |
          - Valida estratÃ©gia existe
          - Carrega configuraÃ§Ã£o
          - Registra estratÃ©gia ativa
          
      - step: 3
        component: Strategy Repository
        action: Persiste configuraÃ§Ã£o
        
      - step: 4
        component: Strategy Engine
        action: Ativa estratÃ©gia para anÃ¡lise
        
      - step: 5
        component: Metrics
        action: strategies_active{strategy="MACD_CROSSOVER"} = 1

  backtest:
    description: Backtesting de estratÃ©gia
    steps:
      - step: 1
        component: Backtest API
        action: Recebe request com parÃ¢metros
        params:
          - strategy: nome da estratÃ©gia
          - symbol: par
          - timeframe: timeframe
          - start_date: inÃ­cio
          - end_date: fim
          - initial_capital: capital inicial
          
      - step: 2
        component: Historical Data Loader
        action: |
          - Carrega candles histÃ³ricos do Postgres ou CSV
          - Filtra por symbol, timeframe, date range
          
      - step: 3
        component: Backtest Engine
        action: |
          - Replay candles sequencialmente
          - Para cada candle:
            - Calcula indicadores
            - Executa estratÃ©gia
            - Se gerar sinal â†’ simula trade
            - Atualiza P&L
          
      - step: 4
        component: Performance Calculator
        action: |
          - Calcula mÃ©tricas:
            - Total return
            - Win rate
            - Profit factor
            - Max drawdown
            - Sharpe ratio
            - NÃºmero de trades
          
      - step: 5
        component: Backtest API
        action: Retorna resultado com mÃ©tricas


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 9. CONFIGURAÃ‡ÃƒO                                              â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

configuration:
  format: YAML + Environment Variables
  precedence: ENV > config file > defaults
  
  files:
    development: config/development.yaml
    production: config/production.yaml
    strategies: config/strategies/*.yaml
    
  structure:
    kafka:
      brokers:
        env: KAFKA_BROKERS
        default: "localhost:9092"
      consumer_group:
        env: KAFKA_CONSUMER_GROUP
        default: "crypto-signals-group"
      topics:
        prices: "crypto-listener.prices"
        signals_buy: "signals.buy"
        signals_sell: "signals.sell"
        
    redis:
      url:
        env: REDIS_URL
        default: "redis://localhost:6379"
      indicator_cache_ttl_seconds:
        env: REDIS_INDICATOR_TTL
        default: 300  # 5 minutos
        
    database:
      url:
        env: DATABASE_URL
        required: true
      pool_size:
        env: DATABASE_POOL_SIZE
        default: 10
        
    candles:
      buffer_size_1m:
        env: CANDLE_BUFFER_1M
        default: 500
      buffer_size_5m: 300
      buffer_size_15m: 200
      buffer_size_1h: 200
      buffer_size_4h: 200
      buffer_size_1d: 365
      persist_to_db:
        env: CANDLES_PERSIST
        default: true
        
    strategies:
      rsi_divergence:
        enabled:
          env: STRATEGY_RSI_DIVERGENCE_ENABLED
          default: true
        symbols: ["BTCUSDT", "ETHUSDT"]
        timeframes: ["15m", "1h"]
        params:
          rsi_period: 14
          oversold: 30
          overbought: 70
          lookback_periods: 20
          
      macd_crossover:
        enabled:
          env: STRATEGY_MACD_ENABLED
          default: true
        symbols: ["BTCUSDT"]
        timeframes: ["1h", "4h"]
        params:
          fast_period: 12
          slow_period: 26
          signal_period: 9
          
      ma_crossover:
        enabled: false
        symbols: ["BTCUSDT"]
        timeframes: ["4h", "1d"]
        params:
          fast_period: 50
          slow_period: 200
          ma_type: "EMA"
          
    filters:
      min_confidence:
        env: FILTER_MIN_CONFIDENCE
        default: 0.7
      min_volume_ratio:
        env: FILTER_MIN_VOLUME_RATIO
        default: 1.0  # 1x average
      require_trend_alignment:
        env: FILTER_TREND_ALIGNMENT
        default: false
        
    metrics:
      enabled:
        env: METRICS_ENABLED
        default: true
      port:
        env: METRICS_PORT
        default: 9090


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 10. MÃ‰TRICAS E OBSERVABILIDADE                               â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

metrics:
  prometheus_endpoint: /metrics
  port: 9090
  
  counters:
    - name: prices_received_total
      help: Total de price updates recebidos
      labels: [symbol]
      
    - name: candles_completed_total
      help: Total de candles completados
      labels: [symbol, timeframe]
      
    - name: signals_generated_total
      help: Total de sinais gerados
      labels: [symbol, strategy, side]
      
    - name: signals_filtered_total
      help: Total de sinais filtrados (rejeitados)
      labels: [symbol, strategy, filter_reason]
      
    - name: strategy_executions_total
      help: Total de execuÃ§Ãµes de estratÃ©gia
      labels: [strategy, symbol, timeframe]
      
    - name: indicator_calculations_total
      help: Total de cÃ¡lculos de indicadores
      labels: [indicator]
      
  histograms:
    - name: candle_build_duration_seconds
      help: DuraÃ§Ã£o da construÃ§Ã£o de candle
      labels: [timeframe]
      buckets: [0.001, 0.005, 0.01, 0.05, 0.1]
      
    - name: strategy_execution_duration_seconds
      help: DuraÃ§Ã£o da execuÃ§Ã£o de estratÃ©gia
      labels: [strategy]
      buckets: [0.01, 0.05, 0.1, 0.5, 1.0, 2.0]
      
    - name: indicator_calculation_duration_seconds
      help: DuraÃ§Ã£o do cÃ¡lculo de indicador
      labels: [indicator]
      buckets: [0.001, 0.005, 0.01, 0.05, 0.1]
      
    - name: signal_confidence
      help: DistribuiÃ§Ã£o de confidence dos sinais
      labels: [strategy]
      buckets: [0.5, 0.6, 0.7, 0.8, 0.9, 1.0]
      
  gauges:
    - name: active_strategies
      help: NÃºmero de estratÃ©gias ativas
      labels: [symbol]
      
    - name: candle_buffer_size
      help: Tamanho do buffer de candles
      labels: [symbol, timeframe]
      
    - name: indicator_cache_hit_rate
      help: Taxa de hit do cache de indicadores
      labels: []

  logging:
    format: JSON (structured logging)
    level: INFO (configurÃ¡vel via env)
    fields:
      - timestamp
      - level
      - message
      - symbol
      - strategy
      - timeframe
      - signal_id
      - duration_ms
      - error (if any)

  tracing:
    enabled: true
    library: tracing / tracing-subscriber
    spans:
      - name: process_price
        fields: [symbol, price]
      - name: build_candle
        fields: [symbol, timeframe]
      - name: execute_strategy
        fields: [strategy, symbol, timeframe]
      - name: generate_signal
        fields: [signal_id, strategy, confidence]


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 11. BACKTESTING                                              â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

backtesting:
  description: |
    Sistema de backtesting para testar estratÃ©gias com dados histÃ³ricos
    antes de usar em produÃ§Ã£o.
    
  features:
    - Historical candle replay
    - Strategy parameter optimization
    - Performance metrics calculation
    - Visualization of results
    - Export to CSV/JSON
    
  workflow:
    - step: 1
      title: Preparar dados histÃ³ricos
      action: |
        - Download candles histÃ³ricos (Binance API ou CSV)
        - Armazenar em data/historical_candles/
        - Ou usar candles jÃ¡ armazenados no Postgres
        
    - step: 2
      title: Configurar backtest
      params:
        - strategy: "RSI_DIVERGENCE"
        - symbol: "BTCUSDT"
        - timeframe: "15m"
        - start_date: "2024-01-01"
        - end_date: "2024-12-31"
        - initial_capital: 10000.0
        - commission: 0.001  # 0.1%
        - strategy_params: {rsi_period: 14, oversold: 30}
        
    - step: 3
      title: Executar backtest
      command: |
        cargo run --bin backtest -- \
          --strategy RSI_DIVERGENCE \
          --symbol BTCUSDT \
          --timeframe 15m \
          --start 2024-01-01 \
          --end 2024-12-31
          
    - step: 4
      title: Analisar resultados
      metrics:
        - Total Return: % ou valor absoluto
        - Win Rate: % de trades vencedores
        - Profit Factor: Lucro bruto / Perda bruta
        - Max Drawdown: MÃ¡xima queda do pico
        - Sharpe Ratio: Retorno ajustado pelo risco
        - Total Trades: NÃºmero de trades
        - Average Win: MÃ©dia dos trades vencedores
        - Average Loss: MÃ©dia dos trades perdedores
        - Largest Win: Maior trade vencedor
        - Largest Loss: Maior trade perdedor
        
  example_output: |
    Backtest Results - RSI_DIVERGENCE (BTCUSDT 15m)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Period: 2024-01-01 to 2024-12-31
    Initial Capital: $10,000.00
    Final Capital: $12,450.00
    
    Performance Metrics:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Total Return: +24.50%
    Win Rate: 62.5%
    Profit Factor: 1.85
    Max Drawdown: -8.2%
    Sharpe Ratio: 1.45
    
    Trade Statistics:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Total Trades: 48
    Winning Trades: 30
    Losing Trades: 18
    Average Win: $125.00
    Average Loss: -$68.00
    Largest Win: $450.00
    Largest Loss: -$215.00
    
    Monthly Returns:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Jan: +3.2%  Feb: -1.5%  Mar: +5.1%  Apr: +2.8%
    May: +1.9%  Jun: +3.5%  Jul: -2.1%  Aug: +4.2%
    Sep: +2.5%  Oct: +1.8%  Nov: +3.9%  Dec: -0.8%
    
  parameter_optimization:
    description: Teste mÃºltiplas combinaÃ§Ãµes de parÃ¢metros
    example: |
      Otimizar RSI_DIVERGENCE:
      - rsi_period: [10, 12, 14, 16, 18]
      - oversold: [25, 30, 35]
      - overbought: [65, 70, 75]
      
      Total combinations: 5 * 3 * 3 = 45 backtests
      
      Result: Melhor combinaÃ§Ã£o
      - rsi_period: 14
      - oversold: 30
      - overbought: 70
      - Return: +28.5%


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 12. INSTRUÃ‡Ã•ES DE DESENVOLVIMENTO                            â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

development_instructions:
  setup:
    prerequisites:
      - Rust 1.75+ (rustup)
      - Docker & Docker Compose
      - Postgres client (psql)
      - Redis client (redis-cli)
      - Kafka client (kafkacat/kcat)
      
    steps:
      - step: 1
        action: Clone o repositÃ³rio
        command: git clone <repo-url> && cd crypto-signals
        
      - step: 2
        action: Copie o arquivo de configuraÃ§Ã£o
        command: cp .env.example .env
        
      - step: 3
        action: Configure as variÃ¡veis de ambiente
        details: |
          Edite .env e configure:
          - DATABASE_URL
          - KAFKA_BROKERS
          - REDIS_URL
          
      - step: 4
        action: Inicie dependÃªncias
        command: docker-compose up -d kafka postgres redis
        
      - step: 5
        action: Execute migrations
        command: cargo run --bin migrate
        
      - step: 6
        action: (Opcional) Baixe dados histÃ³ricos
        command: cargo run --bin download-historical -- --symbol BTCUSDT --timeframe 15m
        
      - step: 7
        action: Instale dependÃªncias Rust
        command: cargo build
        
      - step: 8
        action: Execute o serviÃ§o
        command: cargo run
        
  testing_strategies:
    backtest:
      command: |
        cargo run --bin backtest -- \
          --strategy RSI_DIVERGENCE \
          --symbol BTCUSDT \
          --timeframe 15m \
          --start 2024-01-01 \
          --end 2024-12-31
          
    simulate_prices:
      description: Publicar preÃ§os fictÃ­cios para testar
      command: |
        # Script Python simples
        for i in $(seq 1 100); do
          echo '{"symbol":"BTCUSDT","price":'$((45000 + RANDOM % 1000))',"volume":0.5,"timestamp":"'$(date -u +%Y-%m-%dT%H:%M:%SZ)'"}' | \
          kcat -P -b localhost:9092 -t crypto-listener.prices
          sleep 1
        done
        
  debugging:
    logs:
      command: RUST_LOG=debug cargo run
      
    check_candles:
      command: |
        psql $DATABASE_URL -c "SELECT * FROM candles WHERE symbol='BTCUSDT' AND timeframe='15m' ORDER BY open_time DESC LIMIT 10;"
        
    check_signals:
      command: |
        psql $DATABASE_URL -c "SELECT * FROM signals ORDER BY created_at DESC LIMIT 10;"
        
    monitor_indicators_cache:
      command: |
        redis-cli KEYS "indicator:*"


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 13. ADICIONANDO NOVA ESTRATÃ‰GIA                              â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

adding_new_strategy:
  description: Guia passo a passo para adicionar nova estratÃ©gia
  
  steps:
    - step: 1
      title: Criar arquivo da estratÃ©gia
      action: Criar src/application/strategies/minha_estrategia.rs
      template: |
        use crate::application::strategies::strategy_trait::TradingStrategy;
        use crate::domain::entities::{Candle, Signal};
        use crate::domain::value_objects::{Timeframe, SignalType};
        
        pub struct MinhaEstrategia {
            params: MinhaEstrategiaParams,
        }
        
        pub struct MinhaEstrategiaParams {
            pub param1: usize,
            pub param2: f64,
        }
        
        impl TradingStrategy for MinhaEstrategia {
            fn name(&self) -> &str {
                "MINHA_ESTRATEGIA"
            }
            
            fn analyze(&self, candles: &[Candle], indicators: &IndicatorSet) 
                -> Result<Option<Signal>> 
            {
                // Implementar lÃ³gica aqui
                // Exemplo: se RSI < 30, retorna sinal BUY
                
                if let Some(rsi) = indicators.get("RSI") {
                    if rsi.value < 30.0 {
                        return Ok(Some(Signal::buy(
                            candles.last().unwrap().close,
                            self.name(),
                            0.75,  // confidence
                        )));
                    }
                }
                
                Ok(None)
            }
            
            fn required_candles(&self) -> usize {
                50
            }
            
            fn timeframes(&self) -> &[Timeframe] {
                &[Timeframe::M15, Timeframe::H1]
            }
            
            fn default_params(&self) -> StrategyParams {
                StrategyParams {
                    param1: 14,
                    param2: 2.0,
                }
            }
        }
        
    - step: 2
      title: Criar configuraÃ§Ã£o
      action: Criar config/strategies/minha_estrategia.yaml
      content: |
        enabled: true
        symbols: ["BTCUSDT", "ETHUSDT"]
        timeframes: ["15m", "1h"]
        params:
          param1: 14
          param2: 2.0
          
    - step: 3
      title: Registrar estratÃ©gia
      action: Editar src/infrastructure/bootstrap/strategies.rs
      code: |
        pub fn register_strategies() -> HashMap<String, Box<dyn TradingStrategy>> {
            let mut strategies = HashMap::new();
            
            strategies.insert(
                "RSI_DIVERGENCE".to_string(),
                Box::new(RsiDivergence::new()),
            );
            
            // Adicionar sua estratÃ©gia
            strategies.insert(
                "MINHA_ESTRATEGIA".to_string(),
                Box::new(MinhaEstrategia::new()),
            );
            
            strategies
        }
        
    - step: 4
      title: Testar com backtest
      command: |
        cargo run --bin backtest -- \
          --strategy MINHA_ESTRATEGIA \
          --symbol BTCUSDT \
          --timeframe 15m \
          --start 2024-01-01 \
          --end 2024-12-31
          
    - step: 5
      title: Habilitar em produÃ§Ã£o
      action: |
        Via API:
        curl -X POST http://localhost:8080/api/strategies/MINHA_ESTRATEGIA/enable
        
        Ou editar config/strategies/minha_estrategia.yaml:
        enabled: true


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 14. TROUBLESHOOTING                                          â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

troubleshooting:
  common_issues:
    - issue: "Sinais nÃ£o sendo gerados"
      causes:
        - EstratÃ©gias nÃ£o habilitadas
        - Candles insuficientes no buffer
        - Filtros muito restritivos
        - Indicadores nÃ£o calculados
      solutions:
        - Verificar estratÃ©gias ativas: curl localhost:8080/api/strategies
        - Verificar buffer: SELECT COUNT(*) FROM candles
        - Ajustar filtros (min_confidence, etc)
        - Verificar logs de cÃ¡lculo de indicadores
        
    - issue: "LatÃªncia alta (price â†’ signal)"
      causes:
        - CÃ¡lculo de indicadores lento
        - Cache nÃ£o funcionando
        - Muitas estratÃ©gias ativas
      solutions:
        - Verificar mÃ©tricas: indicator_calculation_duration_seconds
        - Verificar Redis cache hit rate
        - Desabilitar estratÃ©gias nÃ£o essenciais
        - Otimizar cÃ¡lculos (usar ta-rs library)
        
    - issue: "Candles nÃ£o sendo construÃ­dos"
      causes:
        - crypto-listener nÃ£o publicando preÃ§os
        - Consumer Kafka desconectado
        - Erro no candle builder
      solutions:
        - Verificar tÃ³pico: kcat -C -b localhost:9092 -t crypto-listener.prices
        - Verificar logs do consumer
        - Verificar mÃ©tricas: prices_received_total


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 15. ROADMAP & MELHORIAS FUTURAS                              â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

roadmap:
  v1_0:
    status: Current
    features:
      - âœ… MÃºltiplas estratÃ©gias (RSI, MACD, MA Crossover, etc.)
      - âœ… Indicadores tÃ©cnicos
      - âœ… Gerenciamento de candles
      - âœ… Filtragem de sinais
      - âœ… Backtesting bÃ¡sico
      
  v1_1:
    planned_features:
      - Machine learning-based strategies
      - Advanced backtesting (walk-forward, Monte Carlo)
      - Strategy optimization (genetic algorithms)
      - Multi-timeframe analysis
      - Pattern recognition (head and shoulders, triangles, etc.)
      
  v2_0:
    planned_features:
      - AI-powered signal generation
      - Sentiment analysis integration
      - Order book analysis
      - Market regime detection
      - Portfolio optimization
      - Real-time strategy parameter adjustment
      
  future_considerations:
    - Options strategies
    - Arbitrage detection
    - Market making strategies
    - News sentiment integration
    - Social media sentiment
    - On-chain metrics (for crypto)


# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ 16. REFERÃŠNCIAS E DOCUMENTAÃ‡ÃƒO                               â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

references:
  technical_analysis:
    - name: Technical Analysis Library (ta-rs)
      url: https://docs.rs/ta
      
    - name: Investopedia - Technical Indicators
      url: https://www.investopedia.com/terms/t/technicalindicator.asp
      
  trading_concepts:
    - RSI (Relative Strength Index)
    - MACD (Moving Average Convergence Divergence)
    - Bollinger Bands
    - Moving Averages (SMA, EMA)
    - Support and Resistance
    - Candlestick Patterns
    
  rust_libraries:
    - name: ta-rs
      url: https://docs.rs/ta
      description: Technical analysis library
      
    - name: ndarray
      url: https://docs.rs/ndarray
      description: N-dimensional arrays (para cÃ¡lculos)
      
  architecture_patterns:
    - Event-Driven Architecture
    - Hexagonal Architecture (Ports & Adapters)
    - Strategy Pattern
    - Domain-Driven Design (DDD)
    - CQRS (Command Query Responsibility Segregation)


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# FIM DO PROJECT MAP
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
