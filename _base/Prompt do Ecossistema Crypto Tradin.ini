# ğŸš€ Prompt do Ecossistema Crypto Trading

## ğŸ“‹ VisÃ£o Geral do Ecossistema

VocÃª estÃ¡ trabalhando em um **ecossistema de microserviÃ§os para trading de criptomoedas** composto por 5 projetos independentes que se comunicam via **Apache Kafka**. O ecossistema Ã© orientado a eventos, altamente desacoplado e projetado para escalabilidade e resiliÃªncia.

---

## ğŸ—ï¸ Arquitetura do Ecossistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        KAFKA CLUSTER                             â”‚
â”‚  Topics: trades, signals, notifications, webhooks, management    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–² â”‚ â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚ â”‚ â”‚                     â”‚
        â–¼                     â–¼ â”‚ â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚crypto-trader â”‚      â”‚crypto-signalsâ”‚        â”‚crypto-webhookâ”‚
â”‚(ExecuÃ§Ã£o de  â”‚â—„â”€â”€â”€â”€â–ºâ”‚(AnÃ¡lise &    â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚(IntegraÃ§Ã£o   â”‚
â”‚ Ordens)      â”‚      â”‚ EstratÃ©gias) â”‚        â”‚ Externa)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚crypto-notif. â”‚          â”‚crypto-mgmt   â”‚
          â”‚(Alertas &    â”‚          â”‚(GestÃ£o &     â”‚
          â”‚ ComunicaÃ§Ã£o) â”‚          â”‚ Config)      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Projetos e Suas Responsabilidades

### 1ï¸âƒ£ **crypto-trader** (Executor de Ordens)
**Linguagem:** Python  
**Responsabilidade Principal:** Executar ordens de compra/venda em exchanges de criptomoedas

**O QUE FAZ:**
- âœ… Conecta-se a exchanges (Binance, Coinbase, etc.) via API
- âœ… Executa ordens de mercado, limit, stop-loss
- âœ… Publica eventos de trades realizados no Kafka
- âœ… Gerencia carteiras e saldos
- âœ… Implementa retry e circuit breaker para chamadas Ã s exchanges

**O QUE NÃƒO FAZ:**
- âŒ NÃƒO analisa mercado ou gera sinais (responsabilidade do crypto-signals)
- âŒ NÃƒO envia notificaÃ§Ãµes (responsabilidade do crypto-notifications)
- âŒ NÃƒO gerencia configuraÃ§Ãµes globais (responsabilidade do crypto-management)
- âŒ NÃƒO integra com webhooks externos (responsabilidade do crypto-webhook)

**Consume:** `signals` (sinais de trading), `management.config` (configuraÃ§Ãµes)  
**Produz:** `trades` (trades executados)

---

### 2ï¸âƒ£ **crypto-signals** (Analisador e Gerador de Sinais)
**Linguagem:** Python  
**Responsabilidade Principal:** Analisar mercado e gerar sinais de trading

**O QUE FAZ:**
- âœ… Coleta dados de mercado (preÃ§os, volume, order book)
- âœ… Executa anÃ¡lise tÃ©cnica (indicadores: RSI, MACD, Bollinger Bands)
- âœ… Implementa estratÃ©gias de trading (mean reversion, trend following)
- âœ… Gera sinais de BUY/SELL/HOLD
- âœ… Publica sinais no Kafka para consumo do crypto-trader
- âœ… Backtesting de estratÃ©gias

**O QUE NÃƒO FAZ:**
- âŒ NÃƒO executa ordens reais (responsabilidade do crypto-trader)
- âŒ NÃƒO envia alertas diretos aos usuÃ¡rios (responsabilidade do crypto-notifications)
- âŒ NÃƒO persiste configuraÃ§Ãµes de usuÃ¡rios (responsabilidade do crypto-management)

**Consume:** `market.data` (dados de mercado), `management.strategy` (configs de estratÃ©gias)  
**Produz:** `signals` (sinais de trading)

---

### 3ï¸âƒ£ **crypto-notifications** (Central de NotificaÃ§Ãµes)
**Linguagem:** Python  
**Responsabilidade Principal:** Enviar notificaÃ§Ãµes multi-canal aos usuÃ¡rios

**O QUE FAZ:**
- âœ… Consome eventos de todos os projetos do ecossistema
- âœ… Envia notificaÃ§Ãµes via Email, SMS, Telegram, Discord, Slack
- âœ… Formata mensagens especÃ­ficas para cada canal
- âœ… Gerencia templates de mensagens
- âœ… Controla frequÃªncia e throttling de notificaÃ§Ãµes
- âœ… Rastreia status de entrega

**O QUE NÃƒO FAZ:**
- âŒ NÃƒO decide quando notificar (consome eventos jÃ¡ publicados)
- âŒ NÃƒO executa lÃ³gica de negÃ³cio (apenas notifica)
- âŒ NÃƒO armazena preferÃªncias de usuÃ¡rios permanentemente (busca do crypto-management)

**Consume:** `trades`, `signals`, `webhooks.events`, `management.alerts`  
**Produz:** `notifications.sent`, `notifications.failed`

---

### 4ï¸âƒ£ **crypto-webhook** (IntegraÃ§Ã£o com Sistemas Externos)
**Linguagem:** Node.js  
**Responsabilidade Principal:** Receber e processar webhooks de sistemas externos

**O QUE FAZ:**
- âœ… ExpÃµe endpoints HTTP para receber webhooks
- âœ… Valida assinaturas e autenticaÃ§Ã£o de webhooks
- âœ… Normaliza payloads de diferentes fontes (TradingView, Exchanges, APIs)
- âœ… Publica eventos normalizados no Kafka
- âœ… Gerencia rate limiting e seguranÃ§a

**O QUE NÃƒO FAZ:**
- âŒ NÃƒO executa ordens (apenas publica eventos)
- âŒ NÃƒO analisa dados (apenas normaliza e encaminha)
- âŒ NÃƒO envia notificaÃ§Ãµes (apenas recebe e publica)

**Consume:** Nenhum (Ã© ponto de entrada HTTP)  
**Produz:** `webhooks.events`, `external.signals`

---

### 5ï¸âƒ£ **crypto-management** (GestÃ£o e ConfiguraÃ§Ã£o)
**Linguagem:** Python  
**Responsabilidade Principal:** Gerenciar usuÃ¡rios, configuraÃ§Ãµes e monitoramento

**O QUE FAZ:**
- âœ… CRUD de usuÃ¡rios e suas preferÃªncias
- âœ… Gerenciamento de API Keys de exchanges
- âœ… ConfiguraÃ§Ã£o de estratÃ©gias de trading
- âœ… Dashboard de monitoramento e mÃ©tricas
- âœ… Auditoria e logs centralizados
- âœ… Health checks de todos os serviÃ§os
- âœ… Publica configuraÃ§Ãµes via Kafka para outros serviÃ§os

**O QUE NÃƒO FAZ:**
- âŒ NÃƒO executa trades (responsabilidade do crypto-trader)
- âŒ NÃƒO gera sinais (responsabilidade do crypto-signals)
- âŒ NÃƒO envia notificaÃ§Ãµes diretamente (publica eventos para crypto-notifications)

**Consume:** `trades`, `signals`, `notifications.*` (para mÃ©tricas)  
**Produz:** `management.config`, `management.strategy`, `management.alerts`

---

## ğŸ”’ Fronteiras e PrincÃ­pios Arquiteturais

### **PrincÃ­pio da Responsabilidade Ãšnica**
Cada projeto tem UMA responsabilidade clara e bem definida. NÃ£o hÃ¡ sobreposiÃ§Ã£o.

### **ComunicaÃ§Ã£o AssÃ­ncrona**
- Todos os projetos se comunicam APENAS via Kafka
- Nenhuma chamada HTTP direta entre microserviÃ§os (exceto crypto-webhook que recebe HTTP externo)
- PadrÃ£o Publish/Subscribe para desacoplamento mÃ¡ximo

### **IndependÃªncia de Deploy**
- Cada projeto pode ser deployado, escalado e versionado independentemente
- MudanÃ§as em um projeto NÃƒO devem quebrar outros

### **Eventos como Contrato**
- Schemas de eventos Kafka sÃ£o o contrato entre serviÃ§os
- Versionamento de schemas usando Schema Registry (Avro/JSON Schema)

---

## ğŸ“Š TÃ³picos Kafka do Ecossistema

| TÃ³pico | Produtor | Consumidores | Payload |
|--------|----------|--------------|---------|
| `signals` | crypto-signals | crypto-trader | Sinais de BUY/SELL |
| `trades` | crypto-trader | crypto-notifications, crypto-management | Trades executados |
| `webhooks.events` | crypto-webhook | crypto-signals, crypto-notifications | Eventos externos |
| `notifications.sent` | crypto-notifications | crypto-management | NotificaÃ§Ãµes enviadas |
| `management.config` | crypto-management | crypto-trader, crypto-signals | ConfiguraÃ§Ãµes |
| `management.strategy` | crypto-management | crypto-signals | EstratÃ©gias de trading |

---

## ğŸ› ï¸ Stack TecnolÃ³gica

**Backend:**
- Python: crypto-trader, crypto-signals, crypto-notifications, crypto-management
- Node.js: crypto-webhook

**Mensageria:**
- Apache Kafka + Zookeeper
- Schema Registry (Confluent)

**Banco de Dados:**
- PostgreSQL (crypto-management - dados transacionais)
- MongoDB (crypto-signals - dados de mercado time-series)
- Redis (cache compartilhado)

**Infraestrutura:**
- Docker + Docker Compose
- Kubernetes (produÃ§Ã£o)
- Prometheus + Grafana (monitoramento)

---

## ğŸ”„ Fluxo de Exemplo (Trade Completo)

1. **TradingView** â†’ envia webhook â†’ **crypto-webhook**
2. **crypto-webhook** â†’ publica `webhooks.events` â†’ **Kafka**
3. **crypto-signals** â†’ consome evento â†’ analisa â†’ publica `signals` â†’ **Kafka**
4. **crypto-trader** â†’ consome sinal â†’ executa ordem na Binance â†’ publica `trades` â†’ **Kafka**
5. **crypto-notifications** â†’ consome trade â†’ envia Telegram + Email ao usuÃ¡rio
6. **crypto-management** â†’ consome trade â†’ atualiza dashboard de mÃ©tricas

---

## âš ï¸ Pontos de AtenÃ§Ã£o

### **IdempotÃªncia**
Todos os consumers devem ser idempotentes (processar mesma mensagem 2x nÃ£o gera efeito colateral)

### **Dead Letter Queues**
Mensagens com falha vÃ£o para tÃ³picos `.dlq` para anÃ¡lise posterior

### **Circuit Breaker**
Implementado em chamadas a APIs externas (exchanges, provedores de notificaÃ§Ã£o)

### **Rate Limiting**
- Respeito aos limites de API das exchanges
- Controle de frequÃªncia de notificaÃ§Ãµes

### **SeguranÃ§a**
- API Keys encriptadas no crypto-management
- ValidaÃ§Ã£o de assinaturas em webhooks
- AutenticaÃ§Ã£o JWT entre serviÃ§os quando necessÃ¡rio



# ============================================================================
# ECOSSISTEMA CRYPTO TRADING - DOCUMENTAÃ‡ÃƒO DE INTEGRAÃ‡ÃƒO
# ============================================================================
# Ãšltima atualizaÃ§Ã£o: 17/10/2025
# DescriÃ§Ã£o: DocumentaÃ§Ã£o centralizada de todos os serviÃ§os do ecossistema
# ============================================================================

# ============================================================================
# SERVIÃ‡O: CRYPTO-NOTIFICATIONS
# ============================================================================
# RepositÃ³rio: crypto-notifications
# Linguagem: Rust
# Tipo: Kafka Consumer Worker (Event-Driven)
# VersÃ£o: 1.0.0
# DescriÃ§Ã£o: ServiÃ§o de processamento e entrega de notificaÃ§Ãµes multi-canal
#            com throttling, retry automÃ¡tico e formataÃ§Ã£o inteligente
# ============================================================================

[crypto-notifications]
name = "Crypto Notifications Service"
version = "1.0.0"
language = "Rust"
framework = "Tokio (async runtime)"
architecture = "Event-Driven, Domain-Driven Design (DDD)"
type = "Kafka Consumer Worker"

# ----------------------------------------------------------------------------
# KAFKA TOPICS - CONSUMER
# ----------------------------------------------------------------------------
[crypto-notifications.kafka.consumer]
# TÃ³pico de entrada para receber requisiÃ§Ãµes de notificaÃ§Ã£o de outros serviÃ§os
topic = "crypto_notification"
group_id = "crypto-notifications-group"
auto_offset_reset = "earliest"
schema_registry = "http://localhost:8081"
schema = "com.crypto.notifications.NotificationMessage"
description = "Consome mensagens de notificaÃ§Ã£o de todos os serviÃ§os do ecossistema"

# Estrutura da mensagem (Avro Schema):
# - channel: TELEGRAM | DISCORD | EMAIL | WEBHOOK | ALL
# - priority: LOW | NORMAL | HIGH | CRITICAL
# - category: ORDER | POSITION | SIGNAL | ALERT | REPORT | SYSTEM
# - title: string (max 200 chars)
# - message: string (max 4000 chars)
# - data: map<string, string> (opcional, key-value pairs)
# - timestamp: long (epoch millis)

# ----------------------------------------------------------------------------
# KAFKA TOPICS - PRODUCERS
# ----------------------------------------------------------------------------
[crypto-notifications.kafka.producers]
# TÃ³picos de saÃ­da para eventos de status das notificaÃ§Ãµes

[[crypto-notifications.kafka.producers.topics]]
name = "crypto_notification_delivered"
schema = "com.crypto.notifications.NotificationDelivered"
description = "NotificaÃ§Ãµes entregues com sucesso"
# Campos: notification_id, channel, timestamp, delivery_time_ms, attempts

[[crypto-notifications.kafka.producers.topics]]
name = "crypto_notification_failed"
schema = "com.crypto.notifications.NotificationFailed"
description = "NotificaÃ§Ãµes que falharam apÃ³s todas as tentativas de retry"
# Campos: notification_id, channel, error, timestamp, attempts, last_error_message

[[crypto-notifications.kafka.producers.topics]]
name = "crypto_notification_throttled"
schema = "com.crypto.notifications.NotificationThrottled"
description = "NotificaÃ§Ãµes rejeitadas por throttling/rate limiting"
# Campos: notification_id, channel, timestamp, retry_after_seconds, current_rate

# ----------------------------------------------------------------------------
# ENDPOINTS REST API
# ----------------------------------------------------------------------------
[crypto-notifications.endpoints]
# âš ï¸ IMPORTANTE: Este serviÃ§o NÃƒO expÃµe endpoints HTTP REST
# Ã‰ um worker Kafka puro, sem interface HTTP
# ComunicaÃ§Ã£o apenas via Kafka topics
type = "none"
description = "ServiÃ§o worker sem API REST - comunicaÃ§Ã£o 100% via Kafka"

# ----------------------------------------------------------------------------
# DEPENDÃŠNCIAS EXTERNAS
# ----------------------------------------------------------------------------
[crypto-notifications.dependencies]

[crypto-notifications.dependencies.kafka]
service = "Apache Kafka"
brokers = "localhost:9092"
required = true
description = "Message broker para consumo e produÃ§Ã£o de eventos"

[crypto-notifications.dependencies.schema-registry]
service = "Confluent Schema Registry"
url = "http://localhost:8081"
required = true
description = "Registro de schemas Avro para serializaÃ§Ã£o/deserializaÃ§Ã£o"

[crypto-notifications.dependencies.redis]
service = "Redis"
url = "redis://localhost:6379"
required = true
description = "Cache para throttling/rate limiting e deduplicaÃ§Ã£o"

[crypto-notifications.dependencies.telegram]
service = "Telegram Bot API"
url = "https://api.telegram.org"
required = false
description = "API para envio de notificaÃ§Ãµes via Telegram"
config = "Requer BOT_TOKEN e CHAT_ID"

[crypto-notifications.dependencies.postgres]
service = "PostgreSQL"
required = false
description = "PersistÃªncia opcional para event store (futuro)"

# ----------------------------------------------------------------------------
# CARACTERÃSTICAS PRINCIPAIS
# ----------------------------------------------------------------------------
[crypto-notifications.features]
channels = ["Telegram", "Discord (futuro)", "Email (futuro)", "Webhook (futuro)"]
throttling = "Rate limiting por canal com Redis"
retry = "Exponential backoff automÃ¡tico (3 tentativas padrÃ£o)"
formatting = "FormataÃ§Ã£o inteligente com emojis por categoria"
priorities = ["LOW", "NORMAL", "HIGH", "CRITICAL"]
categories = ["ORDER", "POSITION", "SIGNAL", "ALERT", "REPORT", "SYSTEM"]
architecture_pattern = "Domain-Driven Design (DDD) com Event Sourcing"

# ----------------------------------------------------------------------------
# CONFIGURAÃ‡ÃƒO DO RETRY
# ----------------------------------------------------------------------------
[crypto-notifications.retry]
max_attempts = 3
base_delay_seconds = 2
max_delay_seconds = 60
strategy = "Exponential Backoff"

# ----------------------------------------------------------------------------
# THROTTLING / RATE LIMITING
# ----------------------------------------------------------------------------
[crypto-notifications.throttling]
backend = "Redis"
per_channel = true
description = "Rate limiting configurÃ¡vel por canal de notificaÃ§Ã£o"

# ----------------------------------------------------------------------------
# VARIÃVEIS DE AMBIENTE PRINCIPAIS
# ----------------------------------------------------------------------------
[crypto-notifications.environment]
APP__NAME = "crypto-notifications"
APP__LOG_LEVEL = "info"
KAFKA__BROKERS = "localhost:9092"
KAFKA__CONSUMER_GROUP = "crypto-notifications-group"
KAFKA__TOPIC_NOTIFICATION = "crypto_notification"
KAFKA__TOPIC_DELIVERED = "crypto_notification_delivered"
KAFKA__TOPIC_FAILED = "crypto_notification_failed"
KAFKA__TOPIC_THROTTLED = "crypto_notification_throttled"
KAFKA__SCHEMA_REGISTRY_URL = "http://localhost:8081"
REDIS__URL = "redis://localhost:6379"
TELEGRAM__BOT_TOKEN = "<required>"
TELEGRAM__CHAT_ID = "<required>"
TELEGRAM__ENABLED = "true"

# ----------------------------------------------------------------------------
# COMO OUTROS SERVIÃ‡OS DEVEM INTEGRAR
# ----------------------------------------------------------------------------
[crypto-notifications.integration]
description = """
Para enviar notificaÃ§Ãµes ao ecossistema, publique mensagens no tÃ³pico
'crypto_notification' seguindo o schema Avro especificado.

Exemplo de uso:
1. Produzir mensagem no topic 'crypto_notification'
2. Aguardar eventos nos topics de resposta (delivered/failed/throttled)
3. Monitorar logs para troubleshooting

Categorias recomendadas por tipo de evento:
- ORDER: ExecuÃ§Ã£o de ordens, fills, cancelamentos
- POSITION: Abertura/fechamento de posiÃ§Ãµes, stop loss, take profit
- SIGNAL: Sinais de trading, indicadores tÃ©cnicos
- ALERT: Alertas de preÃ§o, volume, volatilidade
- REPORT: RelatÃ³rios periÃ³dicos, balanÃ§os, performance
- SYSTEM: Status do sistema, health checks, erros crÃ­ticos

Prioridades recomendadas:
- CRITICAL: Erros graves, liquidaÃ§Ãµes, margin calls
- HIGH: ExecuÃ§Ãµes de ordem importantes, sinais urgentes
- NORMAL: NotificaÃ§Ãµes padrÃ£o do dia a dia
- LOW: RelatÃ³rios nÃ£o urgentes, informativos
"""

# ============================================================================
# OBSERVAÃ‡Ã•ES GERAIS DO ECOSSISTEMA
# ============================================================================
[ecosystem.notes]
description = """
O serviÃ§o crypto-notifications atua como hub central de notificaÃ§Ãµes para
todos os serviÃ§os do ecossistema crypto trading. Qualquer serviÃ§o pode enviar
notificaÃ§Ãµes atravÃ©s do Kafka topic 'crypto_notification' e receber confirmaÃ§Ã£o
atravÃ©s dos topics de eventos (delivered/failed/throttled).

O serviÃ§o garante:
- Entrega confiÃ¡vel com retry automÃ¡tico
- Rate limiting para evitar spam
- FormataÃ§Ã£o consistente com contexto semÃ¢ntico
- Suporte multi-canal (Telegram inicialmente, outros no futuro)
- Rastreabilidade completa via event sourcing
"""

# ============================================================================
# FIM DA DOCUMENTAÃ‡ÃƒO
# ============================================================================



---

**Este Ã© o contexto completo do ecossistema. Use-o como referÃªncia para entender onde cada funcionalidade deve ser implementada e como os projetos interagem.**